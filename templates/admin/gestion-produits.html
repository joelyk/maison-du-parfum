{% extends "base.html" %}

{% block title %}Gestion des produits - Admin | La Maison du Parfum{% endblock %}

{% block content %}
<section class="section admin-dashboard">
    <div class="container">
        <h2 class="section-title">Gestion des produits</h2>

        <!-- Bloc : Ajouter un produit -->
        <div class="admin-login" style="max-width: 1000px;">
            <h3 style="margin-bottom: 1.5rem;">Ajouter un nouveau produit</h3>

            <!-- enctype pour permettre l'upload d'image -->
            <form class="admin-form"
                  method="POST"
                  action="{{ url_for('admin_ajouter_produit') }}"
                  enctype="multipart/form-data">
                <div class="form-group">
                    <label for="nom">Nom du produit <span style="color:red">*</span></label>
                    <input type="text" id="nom" name="nom" required>
                </div>

                <div class="form-group">
                    <label for="prix">Prix (€) <span style="color:red">*</span></label>
                    <input type="number" step="0.01" id="prix" name="prix" required>
                </div>

                <div class="form-group">
                    <label for="categorie">Catégorie <span style="color:red">*</span></label>
                    <select id="categorie" name="categorie" required>
                        <option value="">-- Choisir une catégorie --</option>
                        <option value="parfums">Parfums</option>
                        <option value="soins-visage">Soins visage</option>
                        <option value="soins-corps">Soins corps</option>
                        <option value="maquillage">Maquillage</option>
                        <option value="accessoires">Accessoires beauté</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="stock">Stock disponible <span style="color:red">*</span></label>
                    <input type="number" id="stock" name="stock" min="0" value="0" required>
                </div>

                <div class="form-group">
                    <label for="image_file">Photo du produit</label>
                    <input type="file" id="image_file" name="image_file" accept="image/png, image/jpeg">
                    <small class="form-help">
                        Formats acceptés : JPG, JPEG, PNG.  
                        Si aucune image n'est téléchargée, un visuel générique pourra être utilisé.
                    </small>
                </div>

                <div class="form-group">
                    <label for="description_courte">Description courte (optionnel)</label>
                    <input type="text" id="description_courte" name="description_courte">
                </div>

                <div class="form-group">
                    <label for="description">Description détaillée (optionnel)</label>
                    <textarea id="description" name="description" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="notes">Notes olfactives / infos supplémentaires (optionnel)</label>
                    <textarea id="notes" name="notes" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label for="contenance">Contenance (ex : 50ml, 100ml) (optionnel)</label>
                    <input type="text" id="contenance" name="contenance">
                </div>

                <div class="form-group">
                    <label for="type_peau">Type de peau (si applicable) (optionnel)</label>
                    <input type="text" id="type_peau" name="type_peau" placeholder="Tous types, peau sèche...">
                </div>

                <div class="form-group">
                    <label for="pour_qui">Pour qui ? (optionnel)</label>
                    <select id="pour_qui" name="pour_qui">
                        <option value="Femme">Femme</option>
                        <option value="Homme">Homme</option>
                        <option value="Unisexe">Unisexe</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary">Ajouter le produit</button>
            </form>
        </div>

        <!-- Bloc : Liste des produits -->
        <div class="admin-table" style="margin-top: 3rem;">
            <h3 style="padding: 1.5rem 1.5rem 0;">Produits existants</h3>

            {% if produits %}
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Visuel</th>
                            <th>Nom</th>
                            <th>Catégorie</th>
                            <th>Prix</th>
                            <th>Stock</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in produits %}
                            <tr>
                                <td>{{ p.id }}</td>
                                <td>
                                    {% if p.image %}
                                        <img src="{{ url_for('static', filename='images/products/' ~ p.image) }}"
                                             alt="{{ p.nom }}"
                                             style="width:50px;height:50px;object-fit:cover;border-radius:4px;">
                                    {% else %}
                                        <span style="font-size: 0.8rem; color:#888;">Aucune image</span>
                                    {% endif %}
                                </td>
                                <td>{{ p.nom }}</td>
                                <td>{{ p.categorie }}</td>
                                <td>{{ "%.2f"|format(p.prix) }} €</td>
                                <td>{{ p.stock }}</td>
                                <td>
                                    <!-- Détails + édition -->
                                    <details>
                                        <summary>Modifier</summary>

                                        <form class="admin-form"
                                              method="POST"
                                              action="{{ url_for('admin_modifier_produit', produit_id=p.id) }}"
                                              enctype="multipart/form-data"
                                              style="margin-top: 1rem;">

                                            <div class="form-group">
                                                <label>Nom <span style="color:red">*</span></label>
                                                <input type="text" name="nom" value="{{ p.nom }}" required>
                                            </div>

                                            <div class="form-group">
                                                <label>Prix (€) <span style="color:red">*</span></label>
                                                <input type="number"
                                                       step="0.01"
                                                       name="prix"
                                                       value="{{ '%.2f'|format(p.prix) }}"
                                                       required>
                                            </div>

                                            <div class="form-group">
                                                <label>Catégorie <span style="color:red">*</span></label>
                                                <select name="categorie" required>
                                                    <option value="parfums" {% if p.categorie == 'parfums' %}selected{% endif %}>Parfums</option>
                                                    <option value="soins-visage" {% if p.categorie == 'soins-visage' %}selected{% endif %}>Soins visage</option>
                                                    <option value="soins-corps" {% if p.categorie == 'soins-corps' %}selected{% endif %}>Soins corps</option>
                                                    <option value="maquillage" {% if p.categorie == 'maquillage' %}selected{% endif %}>Maquillage</option>
                                                    <option value="accessoires" {% if p.categorie == 'accessoires' %}selected{% endif %}>Accessoires beauté</option>
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label>Description courte (optionnel)</label>
                                                <input type="text"
                                                       name="description_courte"
                                                       value="{{ p.description_courte or '' }}">
                                            </div>

                                            <div class="form-group">
                                                <label>Description détaillée (optionnel)</label>
                                                <textarea name="description" rows="3">{{ p.description or '' }}</textarea>
                                            </div>

                                            <div class="form-group">
                                                <label>Image actuelle</label><br>
                                                {% if p.image %}
                                                    <img src="{{ url_for('static', filename='images/products/' ~ p.image) }}"
                                                         alt="{{ p.nom }}"
                                                         style="width:70px;height:70px;object-fit:cover;border-radius:4px;margin-bottom:0.5rem;">
                                                {% else %}
                                                    <span style="font-size: 0.8rem; color:#888;">Aucune image</span>
                                                {% endif %}
                                            </div>

                                            <div class="form-group">
                                                <label>Nouvelle image (optionnel)</label>
                                                <input type="file" name="image_file" accept="image/png, image/jpeg">
                                                <small class="form-help">
                                                    Laisser vide pour conserver l'image actuelle.
                                                </small>
                                            </div>

                                            <div class="form-group">
                                                <label>Stock <span style="color:red">*</span></label>
                                                <input type="number" name="stock" min="0" value="{{ p.stock }}" required>
                                            </div>

                                            <div class="form-group">
                                                <label>Notes (optionnel)</label>
                                                <textarea name="notes" rows="2">{{ p.notes or '' }}</textarea>
                                            </div>

                                            <div class="form-group">
                                                <label>Contenance (optionnel)</label>
                                                <input type="text" name="contenance" value="{{ p.contenance or '' }}">
                                            </div>

                                            <div class="form-group">
                                                <label>Type de peau (optionnel)</label>
                                                <input type="text" name="type_peau" value="{{ p.type_peau or '' }}">
                                            </div>

                                            <div class="form-group">
                                                <label>Pour qui ? (optionnel)</label>
                                                <select name="pour_qui">
                                                    <option value="Femme" {% if p.pour_qui == 'Femme' %}selected{% endif %}>Femme</option>
                                                    <option value="Homme" {% if p.pour_qui == 'Homme' %}selected{% endif %}>Homme</option>
                                                    <option value="Unisexe" {% if p.pour_qui == 'Unisexe' %}selected{% endif %}>Unisexe</option>
                                                </select>
                                            </div>

                                            <button type="submit" class="btn btn-primary">Enregistrer les modifications</button>
                                        </form>
                                    </details>

                                    <!-- Suppression -->
                                    <form class="admin-form"
                                          method="POST"
                                          action="{{ url_for('admin_supprimer_produit', produit_id=p.id) }}"
                                          style="margin-top: 0.5rem;">
                                        <button type="submit"
                                                class="btn btn-outline"
                                                onclick="return confirm('Supprimer ce produit ?');">
                                            Supprimer
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="padding: 1.5rem;">Aucun produit pour le moment. Ajoutez votre premier parfum ✨</p>
            {% endif %}
        </div>

        <div style="margin-top: 2rem;">
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline">
                ← Retour au tableau de bord
            </a>
        </div>
    </div>
</section>
{% endblock %}
